<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" category="exp" ipr="trust200902" docName="draft-mccollum-ntp-tsq-0" consensus="false">
  <front>
    <title abbrev="TSQ">Time Synchronization over QUIC</title>
    <author fullname="Garrett McCollum" initials="G." surname="McCollum">
      <organization>Cisco Systems</organization>
      <address>
        <email>gmccollu@cisco.com</email>
      </address>
    </author>
    <date day="28" month="July" year="2025"/>
    <workgroup>Network Time Protocols</workgroup>
    <abstract>
      <t>This document proposes a modern, secure, and extensible time synchronization protocol designed to operate over the QUIC transport protocol. Known as TSQ (Time Synchronization over QUIC), this protocol aims to address the limitations of traditional NTP by leveraging QUIC's encryption, widespread UDP/443 acceptance, and multiplexed stream capabilities. TSQ is designed for contemporary deployment environments, including enterprise networks, cloud-native systems, containers, and mobile devices, where traditional UDP-based NTP struggles with security, scalability, or operational reliability.</t>
    </abstract>
  </front>
  
  <middle>
    <section title="Introduction">
      <t>Time synchronization is foundational to modern computing. It underpins authentication systems, log correlation, distributed transactions, and more. NTP, the current standard, was designed in a different era and brings challenges related to security, deployment compatibility, and extensibility. TSQ is proposed as a new protocol built directly on top of QUIC, leveraging its modern transport features to provide secure, authenticated, and operationally-friendly time synchronization.</t>
    </section>

    <section title="Terminology">
      <t>The key words <b>MUST</b>, <b>MUST NOT</b>, <b>REQUIRED</b>, <b>SHALL</b>, <b>SHALL NOT</b>, <b>SHOULD</b>, <b>SHOULD NOT</b>, <b>RECOMMENDED</b>, <b>NOT RECOMMENDED</b>, <b>MAY</b>, and <b>OPTIONAL</b> in this document are to be interpreted as described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as shown here.</t>
      <list style="symbols">
        <t><b>TSQ:</b> Time Synchronization over QUIC protocol.</t>
        <t><b>QUIC:</b> A secure, multiplexed transport protocol over UDP.</t>
        <t><b>TLV:</b> Type-Length-Value, a flexible message format.</t>
        <t><b>Precision Mode:</b> An OPTIONAL TSQ feature for low-jitter synchronization.</t>
        <t><b>RTT:</b> Round-trip time.</t>
      </list>
    </section>

    <section title="Scope and Goals">
      <t>TSQ is intended to:</t>
      <list style="symbols">
        <t>Provide secure and authenticated time synchronization</t>
        <t>Support modern deployment scenarios</t>
        <t>Operate in environments where UDP/123 is blocked</t>
        <t>Be extensible and future-proof</t>
        <t>Scale for enterprise and cloud</t>
      </list>
      <t>TSQ is <em>not</em> intended to:</t>
      <list style="symbols">
        <t>Replace NTP in ultra-precise or constrained devices</t>
        <t>Replace public NTP infrastructure without optimization</t>
      </list>
    </section>

    <section title="Protocol Overview">
      <t>TSQ uses QUIC as its transport, establishing secure, short-lived connections. A typical exchange:</t>
      <list style="numbers">
        <t>Client opens a QUIC connection to the TSQ server (UDP/443).</t>
        <t>Client sends a TSQ Request with nonce and timestamp request.</t>
        <t>Server replies with timestamps, echoed nonce, and metadata.</t>
        <t>Client calculates RTT and adjusts clock accordingly.</t>
      </list>
    </section>

    <section title="TSQ Protocol Operation">
      <section title="Connection Establishment">
        <t>TSQ uses QUIC for transport, leveraging its handshake for mutual authentication and encryption. Clients MUST negotiate the TSQ protocol using the ALPN identifier "tsq" during the QUIC handshake. Short-lived or resumed QUIC connections MAY be used to optimize performance.</t>
      </section>
      <section title="TSQ Message Formats">
        <t><b>TSQ Request (Type = 0x01):</b></t>
        <list style="symbols">
          <t><b>Nonce</b>: 16 bytes (MUST be included in all requests)</t>
          <t>Optional extensions</t>
          <t>Optional padding</t>
        </list>
        <t><b>TSQ Response (Type = 0x02):</b></t>
        <list style="symbols">
          <t><b>Echoed Nonce</b>: MUST match the client's nonce</t>
          <t><b>Server Time</b>: Current server time (MUST be included)</t>
          <t><b>Receive Timestamp (T2)</b></t>
          <t><b>Send Timestamp (T3)</b></t>
          <t>Optional metadata and signature</t>
          <t>Optional padding</t>
        </list>
      </section>
        <t>TSQ implementations MUST validate all TLV structures. Malformed messages SHOULD result in connection termination or silent discard. Clients MUST handle missing or invalid nonce echoes and timestamp anomalies (e.g., clock jumps).</t>
      <section title="Message Exchange Flow">
        <t>Each TSQ exchange consists of a request and response over a QUIC stream. Clients and servers MUST capture the following timestamps:</t>
        <list style="symbols">
          <t><b>T1 (Client Transmit Time):</b> The moment the client sends the TSQ Request.</t>
          <t><b>T2 (Server Receive Time):</b> The moment the server receives the TSQ Request.</t>
          <t><b>T3 (Server Transmit Time):</b> The moment the server sends the TSQ Response.</t>
          <t><b>T4 (Client Receive Time):</b> The moment the client receives the TSQ Response.</t>
        </list>
        <t>These timestamps enable the client to calculate round-trip time (RTT) and clock offset. T1 and T4 are recorded by the client and are not transmitted. T2 and T3 are included in the TSQ Response message payload.</t>
      </section>
      <section title="TLV Formats">
        <t><b>TSQ Request (Type = 0x01):</b></t>
        <list style="symbols">
          <t><b>Nonce</b>: 16 bytes (MUST be included in all requests)</t>
          <t>Optional extensions</t>
        </list>
        <t><b>TSQ Response (Type = 0x02):</b></t>
        <list style="symbols">
          <t><b>Echoed Nonce</b>: MUST match the nonce sent by the client</t>
          <t><b>Server Time</b>: Current server time in standardized format (MUST be included)</t>
          <t><b>Receive Timestamp</b>: Time server received the client request</t>
          <t><b>Send Timestamp</b>: Time server sent the response</t>
          <t><b>Optional metadata and signature</b>: MAY include cryptographic signature or implementation-specific metadata</t>
        </list>
      </section>
      <section title="Precision Mode">
        <t>TSQ <b>SHOULD</b> ensure that the sizes of request and response packets are approximately equal to minimize timing bias. Implementations <b>SHOULD</b> use an optional padding field to equalize sizes. Padding <b>MUST NOT</b> interfere with TLV parsing and <b>SHOULD</b> consist of zero-value bytes.</t>
      </section>
      <section title="QUIC Datagram Mode">
        <t>TSQ MAY operate using QUIC DATAGRAM frames when low-latency delivery is preferred over reliability. TSQ messages are encapsulated directly in DATAGRAM frames and parsed using the same TLV structure.</t>
        <t>Loss-tolerant deployments MAY use this mode, but MUST tolerate message drops and SHOULD fall back to streams if synchronization is degraded.</t>
      </section>
      <section title="Error Handling">
        <t>TSQ implementations MUST validate all TLV structures. Malformed messages SHOULD result in connection termination or silent discard. Clients MUST handle missing or invalid nonce echoes and timestamp anomalies (e.g., clock jumps).</t>
      </section>
    </section>

    <section title="Security Considerations">
      <t>TSQ leverages QUIC's security model to ensure confidentiality, integrity, and replay protection. All TSQ messages are encapsulated within encrypted QUIC streams or datagrams, depending on mode.</t>
      <t>The QUIC handshake provides mutual authentication if certificates are validated. In TSQ, this ensures both the client and server are communicating with authenticated endpoints.</t>
      <t>Replay protection is achieved via QUIC's transport guarantees. However, implementations MUST validate echoed nonces and timestamp monotonicity to guard against application-level replay attacks.</t>
      <t>TSQ supports optional digital signatures to support auditability or long-term integrity. Signatures MAY be generated using Ed25519 or HMAC-SHA256, and included in the "Optional metadata and signature" TLV. Signatures MUST cover the entire payload including timestamps and nonce.</t>
      <t>Privacy-conscious deployments SHOULD minimize identifying metadata in TSQ messages and MAY use ephemeral QUIC connections to reduce correlation risk. Servers MAY also implement rate-limiting to mitigate client fingerprinting or denial-of-service vectors.</t>
    </section>

    <section title="Scalability and Deployment Considerations">
      <t>TSQ is designed to operate efficiently in large-scale, heterogeneous environments. It is suitable for use in enterprise, cloud-native, and mobile scenarios where traditional NTP may encounter limitations due to UDP/123 filtering, NAT traversal, or security posture.</t>
      <t>QUIC’s stream multiplexing and NAT rebinding support allow TSQ to serve mobile clients that frequently change IP addresses or network paths. Use of QUIC on UDP/443 also enables easier traversal through firewalls and middleboxes.</t>
      <t>TSQ connections are intended to be short-lived by default, allowing high churn rates with minimal state retention. However, QUIC session resumption MAY be used to optimize recurring exchanges with known servers.</t>
      <t>Implementations MAY operate in a stateless mode by avoiding long-lived session tracking and relying on QUIC’s address validation tokens to prevent abuse. Stateless designs are especially beneficial for high-volume deployments such as cloud-based time services.</t>
      <t>TSQ is not intended to replace the global NTP stratum hierarchy or public time pool infrastructure directly. However, it MAY be used in conjunction with such infrastructure, particularly where UDP-based protocols are not viable or additional metadata, security, or auditability is required.</t>
    </section>
    
    <section title="IANA Considerations">
      <t>This document requests IANA to register the following value in the "TLS Application-Layer Protocol Negotiation (ALPN) Protocol IDs" registry:</t>
      <texttable>
        <ttcol align="left">Protocol</ttcol>
        <ttcol align="left">Identification Sequence</ttcol>
        <ttcol align="left">Reference</ttcol>
        <c>TSQ</c>
        <c>0x03 74 73 71 ("tsq")</c>
        <c>This document</c>
      </texttable>
    </section>

  <back>
    <references>
      <reference anchor="RFC8915">
        <front>
          <title>Network Time Security for the Network Time Protocol</title>
          <author initials="D." surname="Franke" fullname="Daniel Franke"/>
          <author initials="D." surname="Sibold" fullname="Dieter Sibold"/>
          <author initials="K." surname="Teichel" fullname="Kristof Teichel"/>
          <author initials="M." surname="Dansarie" fullname="Marcus Dansarie"/>
          <author initials="R." surname="Sundblad" fullname="Ragnar Sundblad"/>
        </front>
        <seriesInfo name="RFC" value="8915"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/rfc8915"/>
      </reference>
      <reference anchor="RFC7384">
        <front>
          <title>Security Requirements of Time Protocols in Packet Switched Networks</title>
          <author initials="T." surname="Mizrahi" fullname="Tal Mizrahi"/>
        </front>
        <seriesInfo name="RFC" value="7384"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/rfc7384"/>
      </reference>
      <reference anchor="RFC9000">
        <front>
          <title>QUIC: A UDP‑Based Multiplexed and Secure Transport</title>
          <author initials="J." surname="Iyengar" fullname="Jana Iyengar"/>
          <author initials="M." surname="Thomson" fullname="Martin Thomson"/>
        </front>
        <seriesInfo name="RFC" value="9000"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/rfc9000"/>
      </reference>
      <reference anchor="RFC9221">
        <front>
          <title>An Unreliable Datagram Extension to QUIC</title>
          <author initials="T." surname="Pauly" fullname="Tommy Pauly"/>
          <author initials="E." surname="Kinnear" fullname="Eric Kinnear"/>
          <author initials="D." surname="Schinazi" fullname="David Schinazi"/>
        </front>
        <seriesInfo name="RFC" value="9221"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/rfc9221"/>
      </reference>
      <reference anchor="RFC9308">
        <front>
          <title>Applicability of the QUIC Transport Protocol</title>
          <author initials="M." surname="Kühlewind" fullname="Mirja Kühlewind"/>
          <author initials="B." surname="Trammell" fullname="Brian Trammell"/>
        </front>
        <seriesInfo name="RFC" value="9308"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/rfc9308"/>
      </reference>
      <reference anchor="ROUGHTIME">
        <front>
          <title>Roughtime</title>
          <author initials="W." surname="Ladd" fullname="Watson Ladd"/>
          <author initials="M." surname="Dansarie" fullname="Marcus Dansarie"/>
        </front>
        <seriesInfo name="Internet-Draft" value="draft-ietf-ntp-roughtime-14"/>
        <format type="HTML" target="https://datatracker.ietf.org/doc/html/draft-ietf-ntp-roughtime-14"/>
      </reference>
    </references>
  
    <section title="Acknowledgments">
      <t>Special thanks to Joe Clark for insightful comments and review during early iterations of this document.</t>
      <t>Thanks also to participants in the NTP and QUIC IETF Working Groups whose discussions and documents shaped many of the ideas in this work.</t>
    </section>

  </back>

<section title="Appendix A: Comparison to Existing Protocols">
  <t>The following table compares traditional time synchronization approaches to TSQ:</t>
  <texttable>
    <ttcol align="center">Feature</ttcol>
    <ttcol align="center">NTP</ttcol>
    <ttcol align="center">NTS</ttcol>
    <ttcol align="center">TSQ</ttcol>
    <c>Transport</c>
    <c>UDP</c>
    <c>UDP+TLS</c>
    <c>QUIC (UDP/443)</c>
    <c>Encryption</c>
    <c>No</c>
    <c>Yes</c>
    <c>Always</c>
    <c>Extensibility</c>
    <c>Low</c>
    <c>Medium</c>
    <c>High</c>
    <c>Mobile Support</c>
    <c>No</c>
    <c>No</c>
    <c>Yes</c>
    <c>Precision Mode</c>
    <c>No</c>
    <c>No</c>
    <c>Yes</c>
  </texttable>

  <t>TSQ and Roughtime serve complementary purposes. While Roughtime provides cryptographic attestation of coarse-grained time and bootstraps trust in untrusted environments, TSQ is designed for ongoing synchronization with higher precision, session continuity, and transport-layer security. TSQ may follow Roughtime during startup or cold boot scenarios.</t>
</section>

</rfc>
